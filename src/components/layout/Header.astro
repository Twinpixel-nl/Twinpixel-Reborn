---
import LanguageSwitcher from "../ui/LanguageSwitcher.astro";
import { pathFor } from "../../lib/paths";

type Lang = "nl" | "en";
interface Props {
  transparentHeader?: boolean;
}
const { transparentHeader = false } = Astro.props as Props;

const pathname = Astro.url.pathname;
const currentLang: Lang = pathname.startsWith("/en/") ? "en" : "nl";
const homeHref = pathFor(currentLang);

const navLinks =
  currentLang === "nl"
    ? [
        { href: pathFor("nl", "diensten"), label: "Diensten" },
        { href: pathFor("nl", "prijzen"), label: "Prijzen" },
        { href: pathFor("nl", "portfolio"), label: "Portfolio" },
        { href: pathFor("nl", "blog"), label: "Blog" },
        { href: pathFor("nl", "over"), label: "over" },
      ]
    : [
        { href: pathFor("en", "services"), label: "Services" },
        { href: pathFor("en", "pricing"), label: "Pricing" },
        { href: pathFor("en", "portfolio"), label: "Portfolio" },
        { href: pathFor("en", "blog"), label: "Blog" },
        { href: pathFor("nl", "about"), label: "about" },
      ];

const isActive = (href: string) => pathname.startsWith(href);
---

<header
  id="site-header"
  class={transparentHeader
    ? "fixed top-0 inset-x-0 z-40 border-b border-transparent bg-transparent backdrop-blur [&.is-solid]:bg-slate-900/90 [&.is-solid]:border-slate-800/60"
    : "sticky top-0 z-40 border-b border-slate-800/60 bg-slate-900/90 backdrop-blur"}
>
  <nav class="container flex items-center justify-between py-3" aria-label="Primary">
    <a href={homeHref} class="inline-flex items-center gap-2" aria-label="TwinPixel home">
      <img
        src="/logo.svg"
        alt="TwinPixel logo"
        width="128"
        height="32"
        class="h-8 w-auto"
        loading="eager"
        decoding="async"
      />
    </a>

    {/* Desktop nav */}
    <ul class="hidden md:flex items-center gap-6">
      {navLinks.map((link) => (
        <li>
          <a
            class="hover:text-cyan-400"
            href={link.href}
            aria-current={isActive(link.href) ? "page" : undefined}
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>

    {/* Right controls */}
    <div class="hidden md:flex items-center gap-3">
      <LanguageSwitcher />
      <a href={currentLang === 'nl' ? '/contact/' : '/en/contact/'} class="btn-primary whitespace-nowrap">{currentLang === 'nl' ? 'Offerte aanvragen' : 'Request a quote'}</a>
    </div>

    {/* Mobile controls */}
    <details class="md:hidden relative">
      <summary class="list-none flex items-center gap-2 cursor-pointer px-2 py-1 rounded hover:text-cyan-400">
        <span class="sr-only">Menu</span>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
      </summary>
      <div class="absolute right-0 mt-2 w-56 rounded-xl border border-slate-800/60 bg-slate-900/95 backdrop-blur p-3 shadow-xl">
        <nav class="flex flex-col gap-2">
          {navLinks.map((link) => (
            <a class="px-2 py-2 rounded hover:text-cyan-400" href={link.href}>{link.label}</a>
          ))}
          <a href={currentLang === 'nl' ? '/contact/' : '/en/contact/'} class="btn-primary text-center">{currentLang === 'nl' ? 'Offerte aanvragen' : 'Request a quote'}</a>
          <LanguageSwitcher />
        </nav>
      </div>
    </details>
  </nav>
</header>
