---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const site = Astro.site?.toString().replace(/\/$/, "") ?? "";

// Fetch all NL cases
const cases = (await getCollection("cases", ({ data }) => data.lang === "nl"))
  .sort((a, b) => +new Date(b.data.date) - +new Date(a.data.date));

const items = cases.map((c, i) => ({
  "@type": "ListItem",
  position: i + 1,
  name: c.data.title,
  item: `${site}/portfolio/${c.slug}/`,
}));

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Portfolio | TwinPixel",
    "url": `${site}/portfolio/`,
  },
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "itemListElement": items
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": `${site}/` },
      { "@type": "ListItem", "position": 2, "name": "Portfolio", "item": `${site}/portfolio/` }
    ]
  }
];
---

<BaseLayout
  title="Portfolio | TwinPixel"
  description="Cases: probleem → aanpak → resultaat. Snelle, overtuigende websites voor ZZP en MKB in Wageningen."
  lang="nl"
  canonical="/portfolio/"
  alternates={{ nl: `${site}/portfolio/` }}
  jsonLd={jsonLd}
>
  <section class="section">
    <h1 class="text-3xl md:text-4xl font-semibold mb-6">Cases</h1>
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {cases.length === 0 && (
        <p class="text-slate-400">Binnenkort verschijnen hier cases.</p>
      )}
      {cases.map((c) => (
        <a href={`/portfolio/${c.slug}/`} class="block rounded-lg border border-slate-800/60 p-5 hover:border-cyan-700 transition-colors">
          <h2 class="text-lg font-medium">{c.data.title}</h2>
          {c.data.description && <p class="text-slate-400 mt-2">{c.data.description}</p>}
          <p class="text-slate-500 text-sm mt-3">{new Date(c.data.date).toLocaleDateString("nl-NL")}</p>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>
