---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Button from "../../components/Button.astro";
import { getCollection, getEntryBySlug, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("insights", ({ data }) => !data.draft);
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;

const entry = await getEntryBySlug("insights", slug);

if (!entry) {
  // bij build: dit voorkomt rare crashes + geeft duidelijke fout
  throw new Error(`Insight not found: ${slug}`);
}

const { Content } = await render(entry);
const { data } = entry;

const formatDate = (d) =>
  new Intl.DateTimeFormat("nl-NL", { year: "numeric", month: "long", day: "2-digit" }).format(d);

const title = `${data.title} | Insights — TwinPixel`;
const description = data.description ?? "Insight van TwinPixel over webdesign, SEO en conversie.";
---

<BaseLayout title={title} description={description}>
  <article class="article">
    <header class="head">
      <div class="container">
        <a class="back" href="/insights">← Terug naar insights</a>

        <p class="kicker">
          <span>{data.category ? data.category : "Insight"}</span>
          <span class="sep">•</span>
          <time datetime={data.date.toISOString()}>{formatDate(data.date)}</time>
          {data.readingTime ? (
            <>
              <span class="sep">•</span>
              <span>{data.readingTime}</span>
            </>
          ) : null}
        </p>

        <h1 class="h1">{data.title}</h1>

        {data.description && <p class="lead">{data.description}</p>}

        {data.tags?.length ? (
          <div class="tags" aria-label="Tags">
            {data.tags.map((t) => (
              <span class="tag">{t}</span>
            ))}
          </div>
        ) : null}

        <div class="actions">
          <Button href="/contact" variant="primary" label="Plan kennismaking" />
          <Button href="/cases" variant="secondary" label="Bekijk cases" />
        </div>
      </div>
    </header>

    <div class="container body">
      <Content />
    </div>
  </article>

  <style>
    .container{
      width: min(900px, calc(100% - 2rem));
      margin: 0 auto;
    }

    .article{ padding-top: 110px; }

    .head{
      padding: 40px 0 22px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.01);
    }

    .back{
      display:inline-block;
      color: rgba(255,255,255,.60);
      text-decoration:none;
      font-size: 14px;
      margin-bottom: 14px;
    }
    .back:hover{ color: rgba(255,255,255,.88); }

    .kicker{
      margin: 0 0 10px;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: .14em;
      color: rgba(255,255,255,.55);
      display:flex;
      flex-wrap: wrap;
      gap: 0;
      align-items: center;
    }
    .sep{ margin: 0 8px; opacity: .6; }

    .h1{
      margin: 0;
      font-size: clamp(34px, 4.4vw, 54px);
      line-height: 1.05;
      letter-spacing: -0.04em;
      font-weight: 650;
      color: rgba(255,255,255,.96);
    }

    .lead{
      margin: 16px 0 0;
      color: rgba(255,255,255,.72);
      line-height: 1.75;
      font-size: 18px;
      max-width: 70ch;
    }

    .tags{
      margin-top: 14px;
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,.70);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding: 6px 10px;
      border-radius: 999px;
    }

    .actions{
      margin-top: 20px;
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .body{
      padding: 28px 0 70px;
      color: rgba(255,255,255,.82);
      line-height: 1.9;
      font-size: 16px;
    }

    /* markdown polish */
    .body :global(h2){
      margin: 30px 0 10px;
      font-size: 24px;
      letter-spacing: -0.02em;
      line-height: 1.2;
      color: rgba(255,255,255,.95);
    }
    .body :global(h3){
      margin: 22px 0 10px;
      font-size: 18px;
      color: rgba(255,255,255,.92);
    }
    .body :global(p){ margin: 0 0 14px; }
    .body :global(a){
      color: rgba(47,137,255,.95);
      text-decoration: none;
    }
    .body :global(a:hover){ text-decoration: underline; }
    .body :global(ul), .body :global(ol){
      margin: 0 0 14px;
      padding-left: 20px;
      color: rgba(255,255,255,.78);
    }
    .body :global(blockquote){
      margin: 18px 0;
      padding: 14px 16px;
      border-left: 2px solid rgba(47,137,255,.7);
      background: rgba(47,137,255,.06);
      border-radius: 12px;
      color: rgba(255,255,255,.82);
    }
    .body :global(code){
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 0.95em;
    }
    .body :global(pre){
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      padding: 14px;
      border-radius: 14px;
      overflow:auto;
      margin: 18px 0;
    }

    @media (max-width: 980px){
      .article{ padding-top: 92px; }
    }
  </style>
</BaseLayout>
